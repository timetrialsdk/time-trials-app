<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <title>Time Trials</title>

  <!-- Firebase SDK (compat ‚Äì virker p√• GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: 'Orbitron', sans-serif; background: #000; color: #ffb300; padding: 20px; overflow-x: hidden; }

    body::before {
      content: "";
      position: fixed;
      inset: -100%;
      background: repeating-linear-gradient(
        135deg,
        rgba(255, 150, 0, 0.32) 0px,
        rgba(255, 150, 0, 0.32) 16px,
        transparent 16px,
        transparent 320px
      );
      pointer-events: none;
      z-index: 1;
    }

    .flag {
      position: fixed;
      width: 180px;
      height: 130px;
      background-size: 36px 36px;
      background-image:
        linear-gradient(45deg, #000 25%, transparent 25%),
        linear-gradient(-45deg, #000 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #000 75%),
        linear-gradient(-45deg, transparent 75%, #000 75%);
      background-color: #fff;
      z-index: 1;
    }

    .flag-left { top: 140px; left: 40px; transform: rotate(-18deg); }
    .flag-right { bottom: 40px; right: 40px; transform: rotate(12deg); }

    #home, .route-page { position: relative; z-index: 2; }

    .hero { text-align: center; margin-bottom: 30px; }
    .title { font-size: 60px; font-weight: 900; letter-spacing: 6px; }
    .subtitle { font-size: 20px; letter-spacing: 2px; }

    .add-route { max-width: 320px; margin: 20px auto; background: #111; padding: 15px; border-radius: 8px; text-align: center; }

    .runs-title { text-align: center; font-size: 36px; color: #ff3333; margin-bottom: 15px; }

    .routes { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }

    .route-card {
      background: #111; padding: 15px; border-radius: 8px; width: 260px; cursor: pointer;
      transition: transform 0.2s ease;
    }

    .route-page {
      position: fixed; inset: 0; background: #000; display: none; overflow-y: auto; padding: 30px;
    }

    .route-container {
      max-width: 900px; margin: auto; background: #111; padding: 25px; border-radius: 12px;
    }

    .route-header { display: flex; justify-content: space-between; align-items: center; }

    .form-row { display: flex; gap: 8px; margin-bottom: 10px; }

    input {
      padding: 6px; background: #000; color: #ffb300; border: 1px solid #ffb300;
    }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #333; padding: 6px; text-align: center; }

    .trash { color: red; cursor: pointer; }

    .game-box {
      width: 320px; height: 320px; background: #000; border: 2px solid #ffb300;
      margin: 20px auto; display: flex; justify-content: center; align-items: center;
    }
  </style>
</head>

<body>

<div class="flag flag-left"></div>
<div class="flag flag-right"></div>

<div id="home">
  <div class="hero">
    <div class="title">TIME TRIALS</div>
    <div class="subtitle">hvis ikke du ryster, var det ikke hurtigt nok</div>
  </div>

  <div class="add-route">
    <h3>Tilf√∏j ny rute</h3>
    <input id="newRouteName" placeholder="Navn p√• rute"><br><br>
    <button onclick="addRoute()">Tilf√∏j rute</button><br>
    <button onclick="openLeaderboard()">üèÜ Leaderboard</button><br>
    <button onclick="openGames()">üéÆ Games</button>
  </div>

  <div class="runs-title">RUNS</div>
  <div class="routes" id="routes"></div>
</div>

<div class="route-page" id="routePage"></div>
<div class="route-page" id="leaderboardPage"></div>
<div class="route-page" id="gamesPage"></div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyD0Dj_iZYH37GE5ArCidiTgQ5MLb3jatbE",
  authDomain: "time-trials-b519e.firebaseapp.com",
  projectId: "time-trials-b519e",
  storageBucket: "time-trials-b519e.appspot.com",
  messagingSenderId: "491396428595",
  appId: "1:491396428595:web:627bc61e5cd1b9475fc446"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= DATA ================= */
let data = { routes: {} };

db.collection("routes").onSnapshot(snapshot => {
  data.routes = {};
  snapshot.forEach(doc => {
    const d = doc.data();
    data.routes[doc.id] = {
      name: d.name || doc.id,
      runs: d.runs || []
    };
  });
  render();
});

/* ================= ROUTES ================= */
async function addRoute() {
  const name = newRouteName.value.trim();
  if (!name) return;

  await db.collection("routes").doc(name).set({
    name: name,
    runs: []
  });

  newRouteName.value = "";
}

function openRoute(routeId) {
  const route = data.routes[routeId];
  home.style.display = "none";
  routePage.style.display = "block";

  let rows = "";
  route.runs.forEach((e, i) => {
    rows += `
      <tr>
        <td>${i+1}</td>
        <td>${e.name}</td>
        <td>${e.car || "-"}</td>
        <td>${e.time}</td>
        <td>${e.video ? `<a href="${e.video}" target="_blank">Video</a>` : "-"}</td>
        <td><span class="trash" onclick="deleteEntry('${routeId}', ${i})">üóëÔ∏è</span></td>
      </tr>`;
  });

  routePage.innerHTML = `
    <div class="route-container">
      <div class="route-header">
        <h2>${route.name}</h2>
        <button onclick="closeRoute()">‚Üê Tilbage</button>
      </div>

      <div class="form-row">
        <input id="name" placeholder="Navn">
        <input id="car" placeholder="Bil">
        <input id="time" placeholder="mm:ss">
        <input id="video" placeholder="Video link">
        <button onclick="addEntry('${routeId}')">+ Run</button>
      </div>

      <table>
        <tr><th>#</th><th>Navn</th><th>Bil</th><th>Tid</th><th>Video</th><th></th></tr>
        ${rows}
      </table>
    </div>`;
}

function closeRoute() {
  routePage.style.display = "none";
  home.style.display = "block";
}

async function addEntry(routeId) {
  const runs = data.routes[routeId].runs;
  runs.push({
    name: name.value,
    car: car.value,
    time: time.value,
    video: video.value
  });

  await db.collection("routes").doc(routeId).update({ runs });
}

async function deleteEntry(routeId, index) {
  const runs = data.routes[routeId].runs;
  runs.splice(index, 1);
  await db.collection("routes").doc(routeId).update({ runs });
}

/* ================= LEADERBOARD (simpel) ================= */
function openLeaderboard() {
  home.style.display = "none";
  leaderboardPage.style.display = "block";

  leaderboardPage.innerHTML = `
    <div class="route-container">
      <div class="route-header">
        <h2>LEADERBOARD</h2>
        <button onclick="closeLeaderboard()">‚Üê Tilbage</button>
      </div>
      <p>Kommer senere üòé</p>
    </div>`;
}

function closeLeaderboard() {
  leaderboardPage.style.display = "none";
  home.style.display = "block";
}

/* ================= GAMES (SNAKE) ================= */
function openGames() {
  home.style.display = "none";
  gamesPage.style.display = "block";

  gamesPage.innerHTML = `
    <div class="route-container">
      <div class="route-header">
        <h2>SNAKE</h2>
        <button onclick="closeGames()">‚Üê Tilbage</button>
      </div>
      <div class="game-box">
        <canvas id="snake" width="300" height="300"></canvas>
      </div>
    </div>`;
}

function closeGames() {
  gamesPage.style.display = "none";
  home.style.display = "block";
}

/* ================= RENDER HOME ================= */
function render() {
  routes.innerHTML = "";

  for (const id in data.routes) {
    const r = data.routes[id];
    const card = document.createElement("div");
    card.className = "route-card";
    card.innerHTML = `<h3>${r.name}</h3><div>Ingen tider endnu</div>`;
    card.onclick = () => openRoute(id);
    routes.appendChild(card);
  }
}
</script>

</body>
</html>
