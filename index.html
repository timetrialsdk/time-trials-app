<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <title>Time Trials</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: 'Orbitron', sans-serif; background: #000; color: #ffb300; padding: 20px; overflow-x:hidden; }

    body::before {
      content:""; position:fixed; inset:-100%;
      background: repeating-linear-gradient(135deg, rgba(255,150,0,0.32) 0px, rgba(255,150,0,0.32) 16px, transparent 16px, transparent 320px);
      z-index:1; pointer-events:none;
    }

    .flag { position:fixed; width:180px; height:130px; background-size:36px 36px;
      background-image:
        linear-gradient(45deg,#000 25%,transparent 25%),
        linear-gradient(-45deg,#000 25%,transparent 25%),
        linear-gradient(45deg,transparent 75%,#000 75%),
        linear-gradient(-45deg,transparent 75%,#000 75%);
      background-color:#fff; z-index:1;
    }
    .flag-left { top:140px; left:40px; transform:rotate(-18deg); }
    .flag-right { bottom:40px; right:40px; transform:rotate(12deg); }

    #home,.route-page,#login { position:relative; z-index:2; }

    .title { font-size:60px; font-weight:900; letter-spacing:6px; text-align:center; text-shadow:0 0 10px orange; }
    .subtitle { text-align:center; margin-bottom:20px; }

    .add-route { max-width:320px; margin:20px auto; background:#111; padding:15px; border-radius:8px; text-align:center; }

    .runs-title { text-align:center; font-size:36px; color:red; text-shadow:0 0 10px red; }

    .routes { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; }

    .route-card {
      background:#111; padding:15px; border-radius:8px; width:260px; cursor:pointer;
      transition:.2s;
    }
    .route-card:hover { transform:translateY(-6px) scale(1.05); box-shadow:0 0 20px orange; }

    .route-page { position:fixed; inset:0; background:#000; display:none; padding:30px; z-index:1000; }

    .route-container { max-width:900px; margin:auto; background:#111; padding:25px; border-radius:12px; }

    button {
      background:#222; color:#ffb300; border:1px solid #ffb300; border-radius:6px; padding:6px 12px;
      cursor:pointer; transition:.15s;
    }
    button:hover { transform:scale(1.1); box-shadow:0 0 12px orange; color:#ffd65c; }

    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th,td { border:1px solid #333; padding:6px; text-align:center; }

    /* LOGIN */
    #login {
      position:fixed; inset:0; background:#000; display:flex; flex-direction:column;
      justify-content:center; align-items:center;
    }
    #login h1 { font-size:50px; color:#ffb300; margin-bottom:20px; }
    #login input { padding:10px; font-size:18px; }

    /* SNAKE */
    .game-box { width:320px; height:320px; border:2px solid #ffb300; margin:auto; }
  </style>
</head>

<body>

<div class="flag flag-left"></div>
<div class="flag flag-right"></div>

<!-- LOGIN -->
<div id="login">
  <h1>ALLE KAN K√òRE BILEN,<br>MEN IKKE ALLE HAR RETTEN</h1>
  <input id="pw" placeholder="Kodeord">
  <br><br>
  <button onclick="checkPassword()">L√•s op</button>
</div>

<div id="home" style="display:none;">
  <div class="title">TIME TRIALS</div>
  <div class="subtitle">hvis ikke du ryster, var det ikke hurtigt nok</div>

  <div class="add-route">
    <h3>Tilf√∏j ny rute</h3>
    <input id="newRouteName" placeholder="Navn p√• rute"><br><br>
    <button onclick="addRoute()">Tilf√∏j rute</button><br><br>
    <button onclick="openLeaderboard()">üèÜ Leaderboard</button><br><br>
    <button onclick="openGames()">üéÆ Games</button>
  </div>

  <div class="runs-title">RUNS</div>
  <div class="routes" id="routes"></div>
</div>

<div class="route-page" id="routePage"></div>
<div class="route-page" id="leaderboardPage"></div>
<div class="route-page" id="gamesPage"></div>

<script>
// üîê LOGIN
function checkPassword(){
  const pw = document.getElementById("pw").value;
  if(pw === "AK47-DRIFT-TUNE"){
    localStorage.setItem("access","true");
    document.getElementById("login").style.display="none";
    document.getElementById("home").style.display="block";
  } else alert("Forkert kodeord");
}

if(localStorage.getItem("access")==="true"){
  document.getElementById("login").style.display="none";
  document.getElementById("home").style.display="block";
}

// üî• FIREBASE
firebase.initializeApp({
  apiKey: "AIzaSyD0Dj_iZYH37GE5ArCidiTgQ5MLb3jatbE",
  authDomain: "time-trials-b519e.firebaseapp.com",
  projectId: "time-trials-b519e"
});
const db = firebase.firestore();
let data={routes:{}};

db.collection("routes").onSnapshot(snap=>{
  data.routes={};
  snap.forEach(doc=>data.routes[doc.id]=doc.data().runs||[]);
  render();
});

// üõ£ ROUTES
async function addRoute(){
  const name=document.getElementById("newRouteName").value.trim();
  if(!name) return;
  await db.collection("routes").doc(name).set({runs:[]});
}

function openRoute(route){
  document.getElementById("home").style.display="none";
  const page=document.getElementById("routePage");
  page.style.display="block";

  let rows="";
  (data.routes[route]||[]).forEach((e,i)=>{
    rows+=`<tr><td>${i+1}</td><td>${e.name}</td><td>${e.car||"-"}</td><td>${e.time}</td>
    <td>${e.video?`<a href="${e.video}" target="_blank">Video</a>`:"-"}</td></tr>`;
  });

  page.innerHTML=`
  <div class="route-container">
    <button onclick="closeRoute()">‚Üê Tilbage</button>
    <h2>${route}</h2>
    <input id="name" placeholder="Navn">
    <input id="car" placeholder="Bil">
    <input id="time" placeholder="mm:ss">
    <input id="video" placeholder="Video">
    <button onclick="addEntry('${route}')">+ Run</button>
    <table><tr><th>#</th><th>Navn</th><th>Bil</th><th>Tid</th><th>Video</th></tr>${rows}</table>
  </div>`;
}

function closeRoute(){ document.getElementById("routePage").style.display="none"; document.getElementById("home").style.display="block"; }

async function addEntry(route){
  const runs=data.routes[route]||[];
  runs.push({
    name:document.getElementById("name").value,
    car:document.getElementById("car").value,
    time:document.getElementById("time").value,
    video:document.getElementById("video").value
  });
  await db.collection("routes").doc(route).set({runs});
  openRoute(route);
}

// üèÜ LEADERBOARD
function openLeaderboard(){
  document.getElementById("home").style.display="none";
  const page=document.getElementById("leaderboardPage");
  page.style.display="block";
  page.innerHTML=`<div class="route-container"><button onclick="closeLeaderboard()">‚Üê Tilbage</button><h2>LEADERBOARD</h2></div>`;
}
function closeLeaderboard(){ document.getElementById("leaderboardPage").style.display="none"; document.getElementById("home").style.display="block"; }

// üéÆ GAMES
function openGames(){
  document.getElementById("home").style.display="none";
  const page=document.getElementById("gamesPage");
  page.style.display="block";
  page.innerHTML=`<div class="route-container"><button onclick="closeGames()">‚Üê Tilbage</button><h2>SNAKE</h2><div class="game-box"><canvas id="snake" width="300" height="300"></canvas></div></div>`;
}
function closeGames(){ document.getElementById("gamesPage").style.display="none"; document.getElementById("home").style.display="block"; }

// üè† RENDER
function render(){
  const container=document.getElementById("routes");
  container.innerHTML="";
  for(const r in data.routes){
    const card=document.createElement("div");
    card.className="route-card";
    card.innerHTML=`<h3>${r}</h3>`;
    card.onclick=()=>openRoute(r);
    container.appendChild(card);
  }
}

// üîß G√òR FUNKTIONER GLOBALE (FIX)
window.openRoute=openRoute;
window.addRoute=addRoute;
window.addEntry=addEntry;
window.openLeaderboard=openLeaderboard;
window.closeLeaderboard=closeLeaderboard;
window.openGames=openGames;
window.closeGames=closeGames;
window.closeRoute=closeRoute;
</script>

</body>
</html>
