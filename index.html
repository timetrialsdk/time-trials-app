<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
  <title>Time Trials</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { font-family: 'Orbitron', sans-serif; background: #000; color: #ffb300; padding: 20px; position: relative; overflow-x: hidden; }

    body::before {
      content: "";
      position: fixed;
      inset: -100% -100% -100% -100%;
      background: repeating-linear-gradient(
        135deg,
        rgba(255, 150, 0, 0.32) 0px,
        rgba(255, 150, 0, 0.32) 16px,
        transparent 16px,
        transparent 320px
      );
      pointer-events: none;
      z-index: 1;
    }

    .flag {
      position: fixed;
      width: 180px;
      height: 130px;
      background-size: 36px 36px;
      background-image:
        linear-gradient(45deg, #000 25%, transparent 25%),
        linear-gradient(-45deg, #000 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #000 75%),
        linear-gradient(-45deg, transparent 75%, #000 75%);
      background-color: #fff;
      pointer-events: none;
      z-index: 1;
    }

    .flag-left { top: 140px; left: 40px; transform: rotate(-18deg); }
    .flag-right { bottom: 40px; right: 40px; transform: rotate(12deg); }

    #home, .route-page { position: relative; z-index: 2; }

    .hero { text-align: center; margin-bottom: 30px; }
    .title {
      font-size: 60px; font-weight: 900; letter-spacing: 6px;
      color: #ffb300;
      text-shadow: 0 0 6px rgba(255,180,0,0.8), 0 0 16px rgba(255,120,0,0.6);
    }

    .subtitle { font-size: 20px; letter-spacing: 2px; }

    .add-route { max-width: 320px; margin: 20px auto; background: #111; padding: 15px; border-radius: 8px; text-align: center; }

    button {
      padding: 6px 12px;
      background: #222;
      color: #ffb300;
      border: 1px solid #ffb300;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, color 0.15s ease;
      margin-top: 6px;
    }

    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px rgba(255,180,0,0.8);
      color: #ffd65c;
    }

    .runs-title {
      text-align: center;
      font-size: 36px;
      color: red;
      margin-top: 30px;
      text-shadow: 0 0 10px red;
    }

    .routes { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }

    .route-card {
      background: #111;
      padding: 15px;
      border-radius: 8px;
      width: 260px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .route-card:hover {
      transform: translateY(-6px) scale(1.05);
      box-shadow: 0 0 18px rgba(255, 180, 0, 0.6);
    }

    .route-page {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      overflow-y: auto;
      padding: 30px;
      z-index: 1000;
    }

    .route-container {
      max-width: 900px;
      margin: auto;
      background: #111;
      padding: 25px;
      border-radius: 12px;
    }

    canvas { background: #000; }
  </style>
</head>

<body>

<!-- üîí LOGIN GATE -->
<div id="loginGate" style="
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 99999;
  text-align: center;
">
  <div style="
    color: #ffb300;
    font-size: 42px;
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 4px;
    text-shadow: 0 0 8px rgba(255,180,0,0.8), 0 0 20px rgba(255,120,0,0.6);
    margin-bottom: 30px;
  ">
    ALLE KAN K√òRE BILEN<br>
    MEN IKKE ALLE HAR RETTET
  </div>

  <input id="passwordInput" type="password" placeholder="Kodeord" style="
    padding: 12px;
    font-size: 18px;
    background: black;
    color: #ffb300;
    border: 2px solid #ffb300;
    border-radius: 6px;
    margin-bottom: 15px;
    text-align: center;
  ">

  <button onclick="checkPassword()">L√ÖS OP</button>

  <div id="loginError" style="color:red; margin-top:10px; display:none;">
    Forkert kodeord
  </div>
</div>

<!-- FLAGS -->
<div class="flag flag-left"></div>
<div class="flag flag-right"></div>

<div id="home">
  <div class="hero">
    <div class="title">TIME TRIALS</div>
    <div class="subtitle">hvis ikke du ryster, var det ikke hurtigt nok</div>
  </div>

  <div class="add-route">
    <h3>Tilf√∏j ny rute</h3>
    <input id="newRouteName" placeholder="Navn p√• rute"><br>
    <button onclick="addRoute()">Tilf√∏j rute</button><br>
    <button onclick="openLeaderboard()">üèÜ Leaderboard</button><br>
    <button onclick="openGames()">üéÆ Games</button>
  </div>

  <div class="runs-title">RUNS</div>
  <div class="routes" id="routes"></div>
</div>

<div class="route-page" id="leaderboardPage"></div>
<div class="route-page" id="routePage"></div>
<div class="route-page" id="gamesPage"></div>

<script>
// ================= LOGIN SYSTEM (FIKSET) =================
const PASSWORD = "AK47-DRIFT-TUNE";

function checkPassword() {
  const input = document.getElementById("passwordInput").value;
  const gate = document.getElementById("loginGate");

  if (input === PASSWORD) {
    localStorage.setItem("access", "true");
    gate.style.display = "none";
    gate.style.pointerEvents = "none";   // üî• VIGTIG FIX
  } else {
    document.getElementById("loginError").style.display = "block";
  }
}

window.addEventListener("load", () => {
  const gate = document.getElementById("loginGate");
  if (localStorage.getItem("access") === "true") {
    gate.style.display = "none";
    gate.style.pointerEvents = "none";   // üî• VIGTIG FIX
  }
});

// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyD0Dj_iZYH37GE5ArCidiTgQ5MLb3jatbE",
  authDomain: "time-trials-b519e.firebaseapp.com",
  projectId: "time-trials-b519e"
});
const db = firebase.firestore();

let data = { routes: {} };

db.collection("routes").onSnapshot(snapshot => {
  data.routes = {};
  snapshot.forEach(doc => data.routes[doc.id] = doc.data().runs || []);
  render();
});

// ================= ROUTES =================
function addRoute() {
  const name = newRouteName.value.trim();
  if (!name) return;
  db.collection("routes").doc(name).set({ runs: [] });
}

function render() {
  routes.innerHTML = "";
  for (const r in data.routes) {
    const card = document.createElement("div");
    card.className = "route-card";
    card.innerHTML = `<h3>${r}</h3><div>Ingen tider endnu</div>`;
    card.onclick = () => openRoute(r);
    routes.appendChild(card);
  }
}

// ================= GAMES / SNAKE =================
function openGames() {
  home.style.display = "none";
  gamesPage.style.display = "block";
  gamesPage.innerHTML = `
    <div class="route-container">
      <button onclick="closeGames()">‚Üê Tilbage</button>
      <canvas id="snake" width="300" height="300"></canvas>
    </div>
  `;
  startSnake();
}

function closeGames() {
  gamesPage.style.display = "none";
  home.style.display = "block";
}

function startSnake() {
  const c = document.getElementById("snake");
  const ctx = c.getContext("2d");
  let x = 150, y = 150;

  document.onkeydown = e => {
    if (e.key === "ArrowUp") y -= 10;
    if (e.key === "ArrowDown") y += 10;
    if (e.key === "ArrowLeft") x -= 10;
    if (e.key === "ArrowRight") x += 10;
  };

  setInterval(() => {
    ctx.clearRect(0,0,300,300);
    ctx.fillStyle = "#ffb300";
    ctx.fillRect(x,y,10,10);
  },100);
}
</script>

</body>
</html>
