<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TIME TRIALS</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:Arial;background:#111;color:#eee}
button{cursor:pointer}

#loginScreen{
  position:fixed;inset:0;background:black;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  z-index:10
}
#loginScreen h1{color:gold;font-size:36px;margin:0}
#loginScreen p{color:#ccc;font-size:14px;margin:8px 0 16px}
#loginScreen input,#loginScreen button{
  width:200px;padding:8px;margin:4px
}

#app{display:none}
header{text-align:center;padding:16px;background:#000}
header h1{color:gold;margin:0}
header p{color:#ddd;font-size:14px;margin:6px 0 0}

.container{padding:16px}
.route{background:#1c1c1c;padding:10px;border-radius:6px;margin-bottom:10px}

input{
  width:100%;padding:8px;margin-bottom:6px;
  background:#222;border:1px solid #333;color:#eee;border-radius:4px
}

.run{background:#222;padding:6px;border-radius:4px;margin-bottom:4px}
.route-image{width:100%;max-height:300px;object-fit:cover;border-radius:6px;margin-bottom:10px}
.hidden{display:none}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h1>TIME TRIALS</h1>
  <p>alle kan kÃ¸re bilen, men ikke alle har rettet</p>
  <input id="pw" placeholder="Kodeord">
  <button id="loginBtn" type="button">Log ind</button>
</div>

<!-- APP -->
<div id="app">
<header>
  <h1>TIME TRIALS</h1>
  <p>hvis du ikke ryster, var det ikke hurtigt nok</p>
</header>

<div class="container" id="routeList"></div>

<div class="container hidden" id="routePage">
  <button id="backBtn" type="button">â¬… Tilbage</button>

  <input id="routeName" placeholder="Rutenavn">

  <h3>Rute screenshot</h3>
  <input type="file" id="imageInput" accept="image/*">
  <img id="routeImage" class="route-image hidden">

  <h3>TilfÃ¸j run</h3>
  <input id="runName" placeholder="Navn">
  <input id="runTime" placeholder="Tid (mm:ss)">
  <input id="runVideo" placeholder="Video-link">
  <button id="addRunBtn" type="button">TilfÃ¸j run</button>

  <h3>Tider</h3>
  <div id="runs"></div>
</div>
</div>

<script>
// FIREBASE
firebase.initializeApp({
  apiKey:"AIzaSyD0Dj_iZYH37GE5ArCidiTgQ5MLb3jatbE",
  authDomain:"time-trials-b519e.firebaseapp.com",
  projectId:"time-trials-b519e"
});
const db=firebase.firestore();

let currentRoute=null;

// LOGIN
loginBtn.onclick=async()=>{
  if(pw.value==="AK47-DRIFT-TUNE"){
    loginScreen.style.display="none";
    app.style.display="block";
    loadRoutes();
  }else alert("Forkert kodeord");
};

// LOAD ROUTES
async function loadRoutes(){
  routeList.innerHTML='';
  const addBtn=document.createElement("button");
  addBtn.textContent="âž• TilfÃ¸j rute";
  addBtn.type="button";
  addBtn.onclick=addRoute;
  routeList.appendChild(addBtn);

  const snap=await db.collection("routes").get();
  snap.forEach(doc=>{
    const r=doc.data();
    const d=document.createElement("div");
    d.className="route";
    d.innerHTML=`<b>${r.name||"Ny rute"}</b><br>`;
    const open=document.createElement("button");
    open.textContent="Ã…bn";
    open.type="button";
    open.onclick=()=>openRoute(doc.id);
    d.appendChild(open);
    routeList.appendChild(d);
  });
}

// ADD ROUTE
async function addRoute(){
  await db.collection("routes").add({name:"Ny rute",runs:[],image:null});
  loadRoutes();
}

// OPEN ROUTE
async function openRoute(id){
  const doc=await db.collection("routes").doc(id).get();
  currentRoute={id,...doc.data()};

  routeList.classList.add("hidden");
  routePage.classList.remove("hidden");

  routeName.value=currentRoute.name||"";
  routeName.oninput=()=>db.collection("routes").doc(id).update({name:routeName.value});

  if(currentRoute.image){
    routeImage.src=currentRoute.image;
    routeImage.classList.remove("hidden");
  }else routeImage.classList.add("hidden");

  renderRuns();
}

// BACK
backBtn.onclick=()=>{
  routePage.classList.add("hidden");
  routeList.classList.remove("hidden");
  loadRoutes();
};

// IMAGE
imageInput.onchange=e=>{
  const f=e.target.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=async()=>{
    routeImage.src=r.result;
    routeImage.classList.remove("hidden");
    currentRoute.image=r.result;
    await db.collection("routes").doc(currentRoute.id).update({image:r.result});
  };
  r.readAsDataURL(f);
};

// ADD RUN â€” ðŸ”¥ VIRKER NU
addRunBtn.onclick=async()=>{
  if(!runName.value||!runTime.value)return alert("Udfyld navn og tid");
  currentRoute.runs.push({
    name:runName.value,
    time:runTime.value,
    video:runVideo.value
  });
  await db.collection("routes").doc(currentRoute.id).update({runs:currentRoute.runs});
  runName.value=runTime.value=runVideo.value="";
  renderRuns();
};

// RENDER RUNS
function renderRuns(){
  runs.innerHTML='';
  currentRoute.runs.forEach(r=>{
    const d=document.createElement("div");
    d.className="run";
    d.innerHTML=`<b>${r.name}</b> â€“ ${r.time} ${r.video?` Â· <a href="${r.video}" target="_blank">ðŸŽ¥</a>`:""}`;
    runs.appendChild(d);
  });
}
</script>
</body>
</html>
