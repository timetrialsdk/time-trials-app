<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Time Trials</title>

<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  padding:20px;
}
button{
  padding:6px 10px;
  margin:4px 0;
  cursor:pointer;
}
input{
  display:block;
  width:260px;
  padding:8px;
  margin:5px 0;
}
.route, .run{
  background:#222;
  padding:8px;
  margin:6px 0;
}
.medal{font-size:18px;margin-right:4px}
.small-btn{font-size:12px;padding:4px 6px}
hr{margin:20px 0}
</style>
</head>
<body>

<h1 style="color:gold">TIME TRIALS</h1>
<p>hvis du ikke ryster, var det ikke hurtigt nok</p>

<hr>

<!-- ROUTES VIEW -->
<div id="routesView">
  <button id="addRoute">â• TilfÃ¸j rute</button>
  <div id="routes"></div>
</div>

<!-- ROUTE PAGE -->
<div id="routeView" style="display:none">
  <button id="back">â¬… Tilbage</button>
  <button id="deleteRoute" style="margin-left:10px">ğŸ—‘ï¸ Slet rute</button>

  <h2 id="routeTitle"></h2>

  <h3>TilfÃ¸j run</h3>
  <input id="name" placeholder="Navn">
  <input id="time" placeholder="Tid (mm:ss)">
  <input id="video" placeholder="Video-link">
  <button id="addRun">TilfÃ¸j run</button>

  <h3>Alle tider</h3>
  <div id="runs"></div>
</div>

<script>
/* ---------- STORAGE ---------- */
const KEY = "time_trials_routes";

function save(){
  localStorage.setItem(KEY, JSON.stringify(routes));
}
function load(){
  const d = localStorage.getItem(KEY);
  return d ? JSON.parse(d) : [];
}

/* ---------- STATE ---------- */
let routes = load();
let currentRouteIndex = null;

/* ---------- ELEMENTS ---------- */
const routesView = document.getElementById("routesView");
const routeView = document.getElementById("routeView");
const routesDiv = document.getElementById("routes");
const runsDiv = document.getElementById("runs");

/* ---------- HELPERS ---------- */
function timeToSeconds(t){
  const [m,s] = t.split(":").map(Number);
  return m*60 + s;
}

/* ---------- ADD ROUTE ---------- */
document.getElementById("addRoute").onclick = () => {
  routes.push({ name:"Ny rute", runs:[] });
  save();
  renderRoutes();
};

/* ---------- RENDER ROUTES (FORSIDE) ---------- */
function renderRoutes(){
  routesDiv.innerHTML = "";

  routes.forEach((r,i)=>{
    const div = document.createElement("div");
    div.className = "route";

    const sorted = [...r.runs].sort((a,b)=>timeToSeconds(a.time)-timeToSeconds(b.time));

    let top3 = "";
    const medals = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];
    sorted.slice(0,3).forEach((run,idx)=>{
      top3 += `<div>${medals[idx]} ${run.name} â€“ ${run.time}</div>`;
    });

    div.innerHTML = `
      <b>${r.name}</b>
      ${top3 || "<div style='opacity:.6'>Ingen tider endnu</div>"}
    `;

    const open = document.createElement("button");
    open.textContent = "Ã…bn";
    open.onclick = ()=>openRoute(i);

    div.appendChild(open);
    routesDiv.appendChild(div);
  });
}

/* ---------- OPEN ROUTE ---------- */
function openRoute(index){
  currentRouteIndex = index;
  routesView.style.display = "none";
  routeView.style.display = "block";
  document.getElementById("routeTitle").textContent = routes[index].name;
  renderRuns();
}

/* ---------- BACK ---------- */
document.getElementById("back").onclick = ()=>{
  routeView.style.display = "none";
  routesView.style.display = "block";
  renderRoutes();
};

/* ---------- DELETE ROUTE ---------- */
document.getElementById("deleteRoute").onclick = ()=>{
  if(confirm("Vil du slette ruten?")){
    routes.splice(currentRouteIndex,1);
    save();
    routeView.style.display = "none";
    routesView.style.display = "block";
    renderRoutes();
  }
};

/* ---------- ADD RUN ---------- */
document.getElementById("addRun").onclick = ()=>{
  const name = document.getElementById("name").value;
  const time = document.getElementById("time").value;
  const video = document.getElementById("video").value;

  if(!name || !time){
    alert("Udfyld navn og tid");
    return;
  }

  routes[currentRouteIndex].runs.push({name,time,video});
  save();

  document.getElementById("name").value = "";
  document.getElementById("time").value = "";
  document.getElementById("video").value = "";

  renderRuns();
};

/* ---------- RENDER RUNS (ALLE) ---------- */
function renderRuns(){
  runsDiv.innerHTML = "";

  const sorted = [...routes[currentRouteIndex].runs]
    .sort((a,b)=>timeToSeconds(a.time)-timeToSeconds(b.time));

  sorted.forEach((r,i)=>{
    const d = document.createElement("div");
    d.className = "run";

    const del = document.createElement("button");
    del.textContent = "ğŸ—‘ï¸";
    del.className = "small-btn";
    del.onclick = ()=>{
      const idx = routes[currentRouteIndex].runs.indexOf(r);
      routes[currentRouteIndex].runs.splice(idx,1);
      save();
      renderRuns();
    };

    d.innerHTML = `<b>${r.name}</b> â€“ ${r.time} `;
    if(r.video) d.innerHTML += `ğŸ¥ `;
    d.appendChild(del);

    runsDiv.appendChild(d);
  });
}

/* ---------- INIT ---------- */
renderRoutes();
</script>

</body>
</html>
