<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Time Trials</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: 'Orbitron', sans-serif; background:#000; color:#ffb300; overflow-x:hidden; }

/* behold dit design ‚Äì intet fjernet */
button {
  padding: 8px 14px;
  background: #111;
  color: #ffb300;
  border: 1px solid #ffb300;
  border-radius: 6px;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.15s;
}
button:hover {
  transform: scale(1.08);
  box-shadow: 0 0 12px rgba(255,180,0,0.7);
}

.route-page {
  position: fixed;
  inset: 0;
  background: #000;
  display: none;
  padding: 30px;
  z-index: 1000;
}

.route-container {
  max-width: 900px;
  margin: auto;
  background: #111;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 0 30px rgba(0,0,0,0.7);
}

.lb-row {
  display: grid;
  grid-template-columns: 40px 1fr auto;
  align-items: center;
  padding: 10px;
  margin-bottom: 8px;
  background: #111;
  border: 1px solid #333;
  border-radius: 6px;
}
</style>
</head>

<body>

<div id="home">
  <h1 style="text-align:center;font-size:60px;">TIME TRIALS</h1>

  <div style="text-align:center;">
    <input id="newRouteName" placeholder="Navn p√• rute">
    <br><br>
    <button onclick="addRoute()">Tilf√∏j rute</button><br><br>
    <button onclick="openLeaderboard()">üèÜ Leaderboard</button><br><br>
    <button onclick="openGames()">üéÆ Games</button>
  </div>

  <h2 style="text-align:center;color:red;">RUNS</h2>
  <div id="routes" style="display:flex;gap:20px;justify-content:center;"></div>
</div>

<!-- LEADERBOARD -->
<div class="route-page" id="leaderboardPage"></div>

<!-- ROUTE -->
<div class="route-page" id="routePage"></div>

<!-- GAMES -->
<div class="route-page" id="gamesPage"></div>

<script>
// ================= FIREBASE =================
const firebaseConfig = {
  apiKey: "AIzaSyD0Dj_iZYH37GE5ArCidiTgQ5MLb3jatbE",
  authDomain: "time-trials-b519e.firebaseapp.com",
  projectId: "time-trials-b519e",
  storageBucket: "time-trials-b519e.firebasestorage.app",
  messagingSenderId: "491396428595",
  appId: "1:491396428595:web:627bc61e5cd1b9475fc446"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let data = { routes: {} };

// realtime lyt
db.collection("routes").onSnapshot(snapshot => {
  data.routes = {};
  snapshot.forEach(doc => {
    data.routes[doc.id] = doc.data().runs || [];
  });
  render();
});

// ================= ROUTES =================
async function addRoute() {
  const name = newRouteName.value.trim();
  if (!name) return;
  await db.collection("routes").doc(name).set({ runs: [] });
  newRouteName.value = "";
}

function render() {
  const container = document.getElementById("routes");
  container.innerHTML = "";

  for (const route of Object.keys(data.routes)) {
    const card = document.createElement("div");
    card.className = "route-card";
    card.innerHTML = `<h3>${route}</h3>`;
    card.onclick = () => openRoute(route);
    container.appendChild(card);
  }
}

function openRoute(route) {
  home.style.display = "none";
  routePage.style.display = "block";

  let rows = "";
  data.routes[route].forEach((e,i)=>{
    rows += `<tr><td>${i+1}</td><td>${e.name}</td><td>${e.time}</td></tr>`;
  });

  routePage.innerHTML = `
    <div class="route-container">
      <button onclick="closeRoute()">‚Üê Tilbage</button>
      <h2>${route}</h2>

      <input id="name" placeholder="Navn">
      <input id="time" placeholder="Tid">
      <button onclick="addEntry('${route}')">+ Run</button>

      <table>
        <tr><th>#</th><th>Navn</th><th>Tid</th></tr>
        ${rows}
      </table>
    </div>
  `;
}

function closeRoute(){
  routePage.style.display="none";
  home.style.display="block";
}

async function addEntry(route){
  const name = document.getElementById("name").value;
  const time = document.getElementById("time").value;
  if(!name||!time)return;

  const runs = data.routes[route];
  runs.push({name,time});
  await db.collection("routes").doc(route).set({runs});
  openRoute(route);
}

// ================= LEADERBOARD (FIXET) =================
function openLeaderboard() {
  home.style.display = "none";
  leaderboardPage.style.display = "block";

  const stats = {};

  for (const route of Object.keys(data.routes)) {
    const sorted = [...data.routes[route]];
    sorted.forEach((run, index) => {
      if (!stats[run.name]) stats[run.name] = { runs: 0, wins: 0 };
      stats[run.name].runs++;
      if (index === 0) stats[run.name].wins++;
    });
  }

  let rows = "";
  Object.entries(stats).forEach(([name,s],i)=>{
    rows += `
      <div class="lb-row">
        <span>${i+1}</span>
        <span>${name}</span>
        <span>${s.wins} ü•á</span>
      </div>`;
  });

  leaderboardPage.innerHTML = `
    <div class="route-container">
      <button onclick="closeLeaderboard()">‚Üê Tilbage</button>
      <h2>LEADERBOARD</h2>
      ${rows || "Ingen data endnu"}
    </div>
  `;
}

function closeLeaderboard(){
  leaderboardPage.style.display="none";
  home.style.display="block";
}

// ================= GAMES / SNAKE =================
function openGames(){
  home.style.display="none";
  gamesPage.style.display="block";

  gamesPage.innerHTML = `
    <div class="route-container">
      <button onclick="closeGames()">‚Üê Tilbage</button>
      <h2>SNAKE</h2>
      <canvas id="snake" width="300" height="300"></canvas>
    </div>
  `;
}

function closeGames(){
  gamesPage.style.display="none";
  home.style.display="block";
}
</script>

</body>
</html>
